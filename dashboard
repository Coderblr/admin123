"use client";

import { useState, useEffect } from "react";
import { Menu, LogOut } from "lucide-react";
import { styles } from "../../styles/AppStyles";

import Sidebar from "./Sidebar";

// User Views
import HomeView from "./HomeView";
import CifCreationView from "./CifCreationView";
import DepositAccountView from "./DepositAccountView";
import LoanAccountView from "./LoanAccountView";
import CcodAccountView from "./CcodAccountView";
import CkycView from "./CkycView";
import SocialAttributeView from "./SocialAttributeView";
import AmendView from "./AmendView";
import PanCifView from "./PanCifView";
import FundTransferView from "./FundTransferView";
import PpfView from "./PpfView";
import RdView from "./RdView";
import FoView from "./FoView";
import ExcelBatchView from "./ExcelBatchView";
import ModView from "./ModView";
import KccView from "./KccView";
import NocView from "./NocView";
import ErrorResolutionCentreView from "./ErrorResolutionCentreView";
import TellerResetView from "./TellerResetView";
import TellerSignonView from "./TellerSignonView";
import TellerCreationView from "./TellerCreationView";
import Account_to_AccountTransferView from "./Account_to_AccountTransferView";

// Admin Views
import AdminDashboard from "../admin/AdminDashboard";
import UserManagement from "../admin/UserManagement";
import ActivityLogs from "../admin/ActivityLogs";
import UserDetail from "../admin/UserDetail";

export default function Dashboard({ user, onLogout }) {
    const [sidebarOpen, setSidebarOpen] = useState(true);
    const [activeService, setActiveService] = useState("home");
    const [selectedUser, setSelectedUser] = useState(null);

    /**
     * Redirect admin users to Admin Dashboard on first load
     */
    useEffect(() => {
        if (user?.user_type === 1) {
            setActiveService("admin_dashboard");
        }
    }, [user]);

    /**
     * Main content renderer
     */
    const renderContent = () => {
        switch (activeService) {
            case "home":
                return <HomeView user={user} />;

            case "cif":
                return <CifCreationView />;
            case "deposit":
                return <DepositAccountView />;
            case "loan":
                return <LoanAccountView />;
            case "ccod":
                return <CcodAccountView />;
            case "ckyc":
                return <CkycView />;
            case "social":
                return <SocialAttributeView />;
            case "amend":
                return <AmendView />;
            case "pancif":
                return <PanCifView />;
            case "fundtransfer":
                return <FundTransferView />;
            case "ppf":
                return <PpfView />;
            case "rd":
                return <RdView />;
            case "kcc":
                return <KccView />;
            case "mod":
                return <ModView />;
            case "noc":
                return <NocView />;
            case "fo":
                return <FoView />;

            case "tellerreset":
                return <TellerResetView />;
            case "tellersignon":
                return <TellerSignonView />;
            case "tellercreation":
                return <TellerCreationView />;

            case "excel":
                return <ExcelBatchView />;

            case "acc_to_acc":
                return <Account_to_AccountTransferView />;

            case "error":
                return <ErrorResolutionCentreView />;

            /* ================= ADMIN ================= */

            case "admin_dashboard":
                return user?.user_type === 1
                    ? <AdminDashboard />
                    : <div style={styles.accessDenied}>Access denied</div>;

            case "user_management":
                return user?.user_type === 1 ? (
                    <UserManagement
                        onViewUser={(u) => {
                            setSelectedUser(u);
                            setActiveService("user_detail");
                        }}
                        onViewLogs={(u) => {
                            setSelectedUser(u);
                            setActiveService("activity_logs");
                        }}
                    />
                ) : <div style={styles.accessDenied}>Access denied</div>;

            case "activity_logs":
                return user?.user_type === 1 ? (
                    <ActivityLogs
                        user={selectedUser}
                        onBack={() => setActiveService("user_management")}
                    />
                ) : <div style={styles.accessDenied}>Access denied</div>;

            case "user_detail":
                return user?.user_type === 1 ? (
                    <UserDetail
                        user={selectedUser}
                        onBack={() => setActiveService("user_management")}
                    />
                ) : <div style={styles.accessDenied}>Access denied</div>;

            default:
                return <HomeView user={user} />;
        }
    };

    return (
        <div style={styles.dashboardContainer}>
            {/* TOP NAV */}
            <nav style={styles.dashboardNav}>
                <div style={styles.dashNavLeft}>
                    <button
                        onClick={() => setSidebarOpen(!sidebarOpen)}
                        style={styles.menuBtn}
                    >
                        <Menu size={24} />
                    </button>

                    <div style={styles.navBrand}>
                        <div style={styles.logoCircleSmall}>SBI</div>
                        <span style={styles.brandTextSmall}>Test Data Platform</span>
                    </div>
                </div>

                <div style={styles.dashNavRight}>
                    <div style={styles.userInfo}>
                        <div style={styles.userAvatar}>
                            {user?.first_name?.[0] || "U"}
                        </div>
                        <div style={styles.userDetails}>
                            <span style={styles.userNameNav}>
                                {user?.first_name} {user?.last_name}
                            </span>
                            <span style={styles.userRole}>
                                Dept: {user?.department_code}
                            </span>
                        </div>
                    </div>

                    <button
                        onClick={onLogout}
                        style={styles.logoutBtnNav}
                        title="Logout"
                    >
                        <LogOut size={18} />
                    </button>
                </div>
            </nav>

            {/* BODY */}
            <div style={styles.mainContainer}>
                <Sidebar
                    sidebarOpen={sidebarOpen}
                    activeService={activeService}
                    setActiveService={setActiveService}
                    user={user}
                />

                <main style={styles.content}>
                    {renderContent()}
                </main>
            </div>
        </div>
    );
}
